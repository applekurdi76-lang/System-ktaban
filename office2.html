<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø³ÛŒØ³ØªÛ•Ù…ÛŒ ÙÛ•Ø±Ù…ÛŒ ÙÛŒØ±Ù‚Û•ÛŒ Ù©</title>
    <style>
        @font-face {
            font-family: 'KurdishFont';
            src: local('Unikurd Magne'), local('Ali-K.Samik'), local('Tahoma');
        }

        body { font-family: 'KurdishFont', Tahoma; background-color: #f0f2f5; margin: 0; padding: 0; }

        /* Ø¨Û•Ø´ÛŒ Ú©Û†Ù†ØªÚ•Û†Úµ - Ú†Ø§Ù¾ Ù†Ø§Ø¨ÛØª */
        .no-print {
            max-width: 1000px; margin: 20px auto; background: #fff;
            padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .input-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 10px; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-family: inherit; }
        .section-title { font-weight: bold; margin: 15px 0 5px 0; color: #1565c0; border-bottom: 1px solid #ddd; }
        .btn-group { display: flex; gap: 8px; margin-top: 15px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-family: inherit; }
        .btn-save { background: #2e7d32; color: white; }
        .btn-print { background: #1565c0; color: white; }

        /* Ú•ÛÚ©Ø®Ø³ØªÙ†ÛŒ Ù„Ø§Ù¾Û•Ú•Û•ÛŒ A4 Ø¨Û† Ø¦Û•ÙˆÛ•ÛŒ ØªÛ•Ù†Ù‡Ø§ ÛŒÛ•Ú© Ù„Ø§Ù¾Û•Ú•Û• Ø¨ÛØª */
        .print-area {
            position: relative;
            width: 210mm;
            height: 296mm; /* Ú©Û•Ù…ÛÚ© Ú©Û•Ù…ØªØ± Ù„Û• A4 Ø¨Û† Ø¯ÚµÙ†ÛŒØ§ÛŒÛŒ */
            padding: 15mm 20mm;
            margin: 20px auto;
            background: white;
            box-sizing: border-box;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: block;
        }

        /* ÙˆØ§ØªÛ•Ø±Ù…Ø§Ø±Ú©Û•Ú©Ø§Ù† */
        #wm-img-display { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100mm; opacity: 0.05; z-index: 0; pointer-events: none; display: none; }
        #wm-text-display { position: absolute; top: 55%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); font-size: 80px; color: rgba(0, 0, 0, 0.04); font-weight: bold; white-space: nowrap; z-index: 1; pointer-events: none; }

        /* Ù‡ÛØ¯Û•Ø± */
        .header-section { 
            display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; 
            text-align: center; border-bottom: 2.5px solid #000; padding-bottom: 10px; 
            margin-bottom: 15px;
        }
        .header-box { font-size: 14px; font-weight: bold; line-height: 1.6; white-space: pre-line; }
        #logo-preview { width: 32mm; height: auto; }

        .meta-data { display: flex; justify-content: space-between; font-weight: bold; font-size: 16px; margin-bottom: 15px; }
        .dest-box { text-align: center; font-size: 21px; font-weight: bold; margin-bottom: 8px; }
        .sub-box { text-align: center; font-size: 20px; font-weight: bold; margin-bottom: 15px; }

        /* Ù†Ø§ÙˆÛ•Ø±Û†Ú© - Ø³Ù†ÙˆÙˆØ±Ø¯Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¨Û•Ø±Ø²Ø§ÛŒÛŒ Ø¨Û† Ø¦Û•ÙˆÛ•ÛŒ Ù†Û•Ú†ÛØªÛ• Ù„Ø§Ù¾Û•Ú•Û•ÛŒ ØªØ± */
        .letter-text { 
            line-height: 2.1; font-size: 18.5px; text-align: justify; 
            white-space: pre-wrap; direction: rtl;
            max-height: 140mm; /* Ø²Û†Ø±ØªØ±ÛŒÙ† Ù¾Ø§Ù†ØªØ§ÛŒÛŒ Ø¨Û† Ø¯Û•Ù‚Û•Ú©Û• */
            overflow: hidden;
        }

        /* ÙÙˆÙˆØªÛ•Ø±ÛŒ Ø¬ÛÚ¯ÛŒØ± Ù„Û• Ø®ÙˆØ§Ø±Û•ÙˆÛ•ÛŒ Ù„Ø§Ù¾Û•Ú•Û•Ú©Û• */
        .footer-wrapper { 
            position: absolute;
            bottom: 20mm; /* Ù…Û•ÙˆØ¯Ø§ Ù„Û• Ù„ÛÙˆØ§Ø±ÛŒ Ø®ÙˆØ§Ø±Û•ÙˆÛ• */
            left: 20mm;
            right: 20mm;
            border-top: 1.5px solid #000;
            padding-top: 10px; 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 15px;
        }
        .footer-cell { font-size: 14px; line-height: 1.5; white-space: pre-line; }

        @media print {
            @page { size: A4; margin: 0; }
            body { background: none; }
            .no-print { display: none !important; }
            .print-area { margin: 0; border: none; box-shadow: none; width: 210mm; height: 297mm; }
        }
    </style>
</head>
<body>

<div class="no-print">
    <h3 style="text-align:center;">Ø³ÛŒØ³ØªÛ•Ù…ÛŒ ÙÛ•Ø±Ù…ÛŒ (Ú†Ø§Ø±Û•Ø³Û•Ø±ÛŒ ÛŒÛ•Ú© Ù„Ø§Ù¾Û•Ú•Û•)</h3>
    
    <div class="section-title">Ù¡. Ù‡ÛØ¯Û•Ø±</div>
    <div class="input-grid">
        <textarea id="in_h_right" rows="2" placeholder="Ù„Ø§ÛŒ Ú•Ø§Ø³Øª"></textarea>
        <label style="text-align: center;">Ù„Û†Ú¯Û†: <input type="file" onchange="loadImg(this, 'logo-preview')"></label>
        <textarea id="in_h_left" rows="2" placeholder="Ù„Ø§ÛŒ Ú†Û•Ù¾"></textarea>
    </div>

    <div class="section-title">Ù¢. Ø¯Û•Ù‚ Ùˆ ÙˆØ§ØªÛ•Ø±Ù…Ø§Ø±Ú©</div>
    <div class="input-grid">
        <input type="text" id="in_ref" placeholder="Ú˜Ù…Ø§Ø±Û•">
        <input type="date" id="in_date">
        <input type="text" id="wm_input" placeholder="ÙˆØ§ØªÛ•Ø±Ù…Ø§Ø±Ú©">
    </div>
    <div class="input-grid">
        <input type="text" id="in_dest" placeholder="Ø¨Û† / ...">
        <input type="text" id="in_sub" placeholder="Ø¨Ø§Ø¨Û•Øª">
        <input type="file" onchange="loadImg(this, 'wm-img-display')">
    </div>
    <textarea id="in_content" rows="5" placeholder="Ù†Ø§ÙˆÛ•Ø±Û†Ú©..."></textarea>

    <div class="section-title">Ù£. ÙÙˆÙˆØªÛ•Ø±</div>
    <div class="input-grid">
        <textarea id="in_f_right" rows="2" placeholder="Ù„Ø§ÛŒ Ú•Ø§Ø³Øª"></textarea>
        <textarea id="in_f_center" rows="2" placeholder="Ù†Ø§ÙˆÛ•Ù†Ø¯"></textarea>
        <textarea id="in_f_left" rows="2" placeholder="Ù„Ø§ÛŒ Ú†Û•Ù¾"></textarea>
    </div>
    
    <div class="btn-group">
        <button class="btn-save" onclick="saveToArchive()">ğŸ“¥ Ø¦Û•Ø±Ø´ÛŒÙ</button>
        <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ Ú†Ø§Ù¾Ú©Ø±Ø¯Ù†</button>
    </div>

    <table border="1" style="width:100%; margin-top:10px; border-collapse: collapse; background: white;">
        <thead><tr><th>Ú˜Ù…Ø§Ø±Û•</th><th>Ø¨Ø§Ø¨Û•Øª</th><th>Ú©Ø±Ø¯Ø§Ø±</th></tr></thead>
        <tbody id="archiveBody"></tbody>
    </table>
</div>

<div class="print-area">
    <img id="wm-img-display" src="">
    <div id="wm-text-display"></div>

    <div class="header-section">
        <div class="header-box" id="out_h_right" style="text-align: right;"></div>
        <div class="header-center"><img id="logo-preview" src="https://via.placeholder.com/100"></div>
        <div class="header-box" id="out_h_left" style="text-align: left;"></div>
    </div>

    <div class="meta-data">
        <div>Ú•ÛÚ©Û•ÙˆØª: <span id="out_date"></span></div>
        <div>Ú˜Ù…Ø§Ø±Û•: <span id="out_ref"></span></div>
    </div>

    <div class="dest-box">Ø¨Û† / <span id="out_dest"></span></div>
    <div class="sub-box" id="out_sub"></div>
    <div class="letter-text" id="out_content"></div>

    <div class="footer-wrapper">
        <div class="footer-cell" id="out_f_right" style="text-align: right;"></div>
        <div class="footer-cell" id="out_f_center" style="text-align: center; font-weight: bold;"></div>
        <div class="footer-cell" id="out_f_left" style="text-align: left;"></div>
    </div>
</div>

<script>
    function loadImg(input, id) {
        if (input.files && input.files[0]) {
            const r = new FileReader();
            r.onload = (e) => { 
                const el = document.getElementById(id);
                el.src = e.target.result; el.style.display = "block";
            };
            r.readAsDataURL(input.files[0]);
        }
    }

    function refresh() {
        document.getElementById('out_h_right').innerText = document.getElementById('in_h_right').value;
        document.getElementById('out_h_left').innerText = document.getElementById('in_h_left').value;
        document.getElementById('out_ref').innerText = document.getElementById('in_ref').value;
        document.getElementById('out_date').innerText = document.getElementById('in_date').value;
        document.getElementById('out_dest').innerText = document.getElementById('in_dest').value;
        document.getElementById('out_sub').innerText = "Ø¨Ø§Ø¨Û•Øª / " + document.getElementById('in_sub').value;
        document.getElementById('out_content').innerText = document.getElementById('in_content').value;
        document.getElementById('out_f_right').innerText = document.getElementById('in_f_right').value;
        document.getElementById('out_f_center').innerText = document.getElementById('in_f_center').value;
        document.getElementById('out_f_left').innerText = document.getElementById('in_f_left').value;
        const wm = document.getElementById('wm_input').value;
        document.getElementById('wm-text-display').innerText = wm;
        document.getElementById('wm-text-display').style.display = wm ? "block" : "none";
    }

    function saveToArchive() {
        const d = {
            id: Date.now(), ref: document.getElementById('in_ref').value,
            sub: document.getElementById('in_sub').value, date: document.getElementById('in_date').value,
            dest: document.getElementById('in_dest').value, cont: document.getElementById('in_content').value,
            hr: document.getElementById('in_h_right').value, hl: document.getElementById('in_h_left').value,
            fr: document.getElementById('in_f_right').value, fc: document.getElementById('in_f_center').value, fl: document.getElementById('in_f_left').value
        };
        let a = JSON.parse(localStorage.getItem('army_archive_v8')) || [];
        a.push(d); localStorage.setItem('army_archive_v8', JSON.stringify(a));
        showArchive();
    }

    function showArchive() {
        let a = JSON.parse(localStorage.getItem('army_archive_v8')) || [];
        let h = "";
        a.reverse().forEach(i => {
            h += `<tr><td>${i.ref}</td><td>${i.sub}</td>
            <td><button onclick="loadOld(${i.id})">Ø¨ÛŒÙ†ÛŒÙ†</button></td></tr>`;
        });
        document.getElementById('archiveBody').innerHTML = h;
    }

    function loadOld(id) {
        let a = JSON.parse(localStorage.getItem('army_archive_v8'));
        let i = a.find(x => x.id === id);
        document.getElementById('in_ref').value = i.ref; document.getElementById('in_sub').value = i.sub;
        document.getElementById('in_date').value = i.date; document.getElementById('in_dest').value = i.dest;
        document.getElementById('in_content').value = i.cont; document.getElementById('in_h_right').value = i.hr;
        document.getElementById('in_h_left').value = i.hl; document.getElementById('in_f_right').value = i.fr;
        document.getElementById('in_f_center').value = i.fc; document.getElementById('in_f_left').value = i.fl;
        refresh(); window.scrollTo(0,0);
    }

    document.querySelectorAll('input, textarea').forEach(el => el.addEventListener('input', refresh));
    window.onload = showArchive;
</script>

</body>
</html>
